# geolfond
Получение основных данных для НДПИ
Все показатели для расчетов коэффициентов и не только

## Что делает?
Загружает:
* Сведения лицензиях из реестра лицензий на право пользование недрами
* Средний курс $ ЦБ РФ для коэффициента Р
* Средняя цена Аргус для коэффициента Ц
* Цены СпбМТБ Регуляр-92 и ДТ для расчета лимитов Демпфера
* Расчет показателей для вычета акциза ФАС 
* Цена на нефть для расчета экспортной пошлины (мониторинг)

Обрабатывает данные и сохраняет в таблицу Excel<br>
Сохраненную таблицу направляет на электронную почту<br>

Добавляй скрипт в cron или systemd и получай нужные для НДПИ и АНС данные прямо от истоников

## New 
* Добавлен Dockerfile. Теперь никаких "а на моей машине работает" работает у всех

## New in version 3:
* Проект переведен на pipenv

## New in version 2:
* Средние Цабвр и Цдтвр
* Цены аргус и ЦБ РФ
* Поддержка прокси (SOCKS5)
* Логгер


Данные о недропользователях включают дополнительные столбцы: 
* prev_owner - предыдущий недропользователь
* prev_lic - номер предыдущей лицензии для данной записи
* forw_lic - номер следующей лицензии для данной записи
* Last[True]: запись лицензии последняя по данному ЛУ
* Last[False]: запись лицензии не последняя (историеская) по данному ЛУ
* N - Самая сверная координата северной шиторы лицензионного учатка для определения применимости льготы по НДД для нефтегазовых провинций севернее 65-го градуса северной широт
* E - Соответствующая ей координата восточной долготы
* status - Действующая\Аннулированная\Приостановленная\Отозванная

## Обычная Установка
```
pip install pipenv 

git clone https://github.com/oleg-wl/geolfond/
pipenv sync

from Parser import reestr
reesrt.basic_config()
```
Открой config.ini и заполни нужные разделы
<br>

## Установка через Докер 
```
docker built -t geolfond .
docker run --rm geolfond
```

## Как пользоваться
Простой сценарий: скачать данные по УВС, все цены и расчеты на текущую дату <br>
Выгрузка всех данных из реестра и нсех индикативов в один файл в data/main.xlsx и отправка его на почту:
```
pipenv run ./geolfond.py
```

Сценарий с автоматизацией: добавь в config.ini свой почтовый smtp сервер и адрес для отправки
```
0 0 */15 * * cron python geolfond.py
```
Вся выгрузка прилетит на почту каждое 15 число месяца. В случае ошибки прилетит лог-файл. <br>

Основные команды [!В разработке]
```
python main.py --help

python main.py filter // показать код фильтра для вида ПИ лицензии
python main.py get-reestr // Запрос по фильтру кода ПИ лицензии (default 'oil')
python main.py get-reestr -f water //Запрос по фильтру кода ПИ лицензии "Подземные воды"
```

Есть вопросы, пиши: [geolfondapp@mail.ru](mailto:geolfondapp@mail.ru)

